<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024å…¨å›½ç”µåŠ›è¾“é€æ€åŠ¿å›¾ - PPTä¸“ç”¨ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        /* å…¨å±€é‡ç½® */
        body {
            margin: 0;
            padding: 0;
            background-color: #e0e0e0;
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* 16:9 å¹»ç¯ç‰‡å®¹å™¨ */
        #slide-container {
            width: 1600px;
            height: 900px;
            background-color: #ffffff;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.2);
            display: flex;
            overflow: hidden;
        }

        /* å·¦ä¾§åœ°å›¾åŒºåŸŸ */
        #map-area {
            flex: 1;
            height: 100%;
            position: relative;
        }

        /* æ ‡é¢˜æ ·å¼ */
        .slide-header {
            position: absolute;
            top: 30px;
            left: 40px;
            z-index: 10;
        }
        .slide-title {
            font-size: 32px;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .slide-subtitle {
            font-size: 16px;
            color: #7f8c8d;
            margin-top: 8px;
            font-weight: 400;
        }

        /* å³ä¾§æ•°æ®å¡ç‰‡ */
        #data-panel {
            width: 420px;
            height: 840px;
            margin: 30px 30px 30px 0;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border: 1px solid #eee;
            z-index: 20;
            display: flex;
            flex-direction: column;
            padding: 30px;
            box-sizing: border-box;
            backdrop-filter: blur(10px);
        }

        .panel-section-title {
            font-size: 18px;
            font-weight: 700;
            color: #34495e;
            margin-bottom: 20px;
            padding-left: 10px;
            border-left: 5px solid #2980b9;
            line-height: 1;
        }

        /* æ¡å½¢å›¾æ ·å¼ */
        .chart-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .row-label {
            width: 60px;
            font-weight: 600;
            color: #555;
            text-align: right;
            margin-right: 12px;
        }
        .bar-container {
            flex: 1;
            height: 12px;
            background: #f0f2f5;
            border-radius: 6px;
            overflow: hidden;
            margin-right: 10px;
        }
        .bar-fill {
            height: 100%;
            border-radius: 6px;
        }
        .row-value {
            width: 50px;
            text-align: right;
            font-weight: 700;
            font-family: Consolas, Monaco, monospace;
        }

        .color-in { background-color: #c0392b; }
        .color-out { background-color: #00897b; }
        .text-in { color: #c0392b; }
        .text-out { color: #00897b; }

        .summary-box {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: auto;
            border: 1px solid #e9ecef;
        }
        .summary-text {
            font-size: 14px;
            color: #555;
            line-height: 1.8;
            margin: 0 0 10px 0;
        }
        .summary-text strong {
            color: #2c3e50;
        }

        .custom-legend {
            position: absolute;
            bottom: 40px;
            left: 40px;
            background: rgba(255,255,255,0.9);
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid #eee;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            font-size: 13px;
            line-height: 24px;
            color: #555;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 8px;
        }
        .legend-arrow {
            color: #2c3e50;
            font-weight: 900;
            margin-right: 8px;
            font-size: 20px;
        }
    </style>
</head>
<body>

    <div id="slide-container">
        
        <div id="map-area">
            <div class="slide-header">
                <h1 class="slide-title">2024 å…¨å›½ç”µåŠ›ä¾›éœ€ä¸è¾“é€æ€åŠ¿å›¾</h1>
                <div class="slide-subtitle">æ•°æ®æ¥æºï¼š2024å¹´å…¨ç¤¾ä¼šç”¨ç”µé‡ä¸è§„ä¸Šå‘ç”µé‡ç»Ÿè®¡ | å•ä½ï¼šäº¿åƒç“¦æ—¶</div>
            </div>
            
            <div id="echarts-map" style="width: 100%; height: 100%;"></div>

            <div class="custom-legend">
                <div style="font-weight:700; margin-bottom:8px; color:#333;">å›¾ä¾‹è¯´æ˜</div>
                <div class="legend-item"><div class="legend-dot" style="background:#c0392b"></div>å‡€è¾“å…¥ (ç¼ºå£ > 1000)</div>
                <div class="legend-item"><div class="legend-dot" style="background:#ffab91"></div>å‡€è¾“å…¥ (ç¼ºå£ 50-1000)</div>
                <div class="legend-item"><div class="legend-dot" style="background:#b2dfdb"></div>å‡€è¾“å‡º (ç›ˆä½™ 50-1000)</div>
                <div class="legend-item"><div class="legend-dot" style="background:#00897b"></div>å‡€è¾“å‡º (ç›ˆä½™ > 1000)</div>
                <div class="legend-item"><div class="legend-dot" style="border:1px solid #ccc; background:#fff"></div>åŸºæœ¬å¹³è¡¡</div>
                <div class="legend-item" style="margin-top:5px;"><span class="legend-arrow">â</span>ç‰¹é«˜å‹è¾“ç”µé€šé“</div>
            </div>
        </div>

        <div id="data-panel">
            <div style="margin-bottom: 30px;">
                <div class="panel-section-title">âš¡ å‡€è¾“å‡º TOP 5 (é€ç«¯/å–ç”µ)</div>
                <div id="export-bars"></div>
            </div>

            <div style="margin-bottom: 30px;">
                <div class="panel-section-title">ğŸ”Œ å‡€è¾“å…¥ TOP 5 (å—ç«¯/ä¹°ç”µ)</div>
                <div id="import-bars"></div>
            </div>

            <div class="summary-box">
                <div class="panel-section-title" style="border-color: #7f8c8d; margin-bottom: 15px;">ğŸ“Š æ ¼å±€åˆ†æ</div>
                <p class="summary-text"><strong>1. åŒ—ç”µå—é€ (ç«/é£/å…‰)ï¼š</strong><br>å†…è’™(-3084)ã€å±±è¥¿ã€æ–°ç–†ä½œä¸ºä¸‰å¤§èƒ½æºåŸºåœ°ï¼Œæ”¯æ’‘äº¬æ´¥å†€ä¸åä¸œç”¨ç”µã€‚</p>
                <p class="summary-text"><strong>2. è¥¿ç”µä¸œé€ (æ°´/å…‰)ï¼š</strong><br>äº‘å—(-1787)ã€å››å·(-1285)æ¸…æ´æ°´ç”µä¸»åŠ›å¤–é€ï¼Œåˆ†åˆ«å¯¹å£æ”¯æ´å¹¿ä¸œä¸æ±Ÿæµ™æ²ªã€‚</p>
                <p class="summary-text"><strong>3. è´Ÿè·ä¸­å¿ƒï¼š</strong><br>å¹¿ä¸œã€æµ™æ±Ÿã€æ±Ÿè‹å‡ä¸ºè¿‘2000äº¿çº§å‡€è¾“å…¥å¤§çœï¼Œå¯¹å¤–ä¾å­˜åº¦é«˜ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // --- æ•°æ®é…ç½® ---
        const rawData = [
            {name: "å†…è’™å¤", value: -3084}, {name: "äº‘å—", value: -1787}, {name: "å±±è¥¿", value: -1547},
            {name: "å››å·", value: -1285}, {name: "æ–°ç–†", value: -1213}, {name: "å®å¤", value: -846},
            {name: "é™•è¥¿", value: -789}, {name: "è´µå·", value: -700}, {name: "æ¹–åŒ—", value: -639},
            {name: "ç”˜è‚ƒ", value: -534}, {name: "ç¦å»º", value: -254}, {name: "å®‰å¾½", value: -249},
            {name: "å‰æ—", value: -187}, {name: "é»‘é¾™æ±Ÿ", value: -122}, {name: "é’æµ·", value: 0}, 
            {name: "å¹¿ä¸œ", value: 1909}, {name: "æµ™æ±Ÿ", value: 1799}, {name: "æ±Ÿè‹", value: 1757},
            {name: "å±±ä¸œ", value: 1548}, {name: "æ²³åŒ—", value: 1116}, {name: "åŒ—äº¬", value: 935},
            {name: "ä¸Šæµ·", value: 899}, {name: "æ²³å—", value: 589}, {name: "æ¹–å—", value: 487},
            {name: "è¾½å®", value: 452}, {name: "é‡åº†", value: 400}, {name: "å¤©æ´¥", value: 252},
            {name: "æ±Ÿè¥¿", value: 225}, {name: "å¹¿è¥¿", value: 133}, {name: "æµ·å—", value: 50},
            {name: "è¥¿è—", value: 0}
        ];

        // åŸºç¡€ç»çº¬åº¦
        const geoCoordMap = {
            'æ–°ç–†': [86.61, 42.79], 'å†…è’™å¤': [112.67, 41.81], 'å››å·': [103.06, 30.66],
            'äº‘å—': [101.71, 24.04], 'å±±è¥¿': [112.54, 37.85], 'å®å¤': [106.27, 37.46],
            'ç”˜è‚ƒ': [103.82, 36.05], 'é™•è¥¿': [108.94, 34.26], 'å¹¿ä¸œ': [113.28, 23.12],
            'æ±Ÿè‹': [119.76, 33.04], 'æµ™æ±Ÿ': [120.15, 29.28], 'å±±ä¸œ': [118.00, 36.67],
            'åŒ—äº¬': [116.40, 40.40], 'ä¸Šæµ·': [121.47, 31.23], 'æ²³å—': [113.66, 33.75],
            'å®‰å¾½': [117.28, 31.86], 'æ¹–å—': [111.98, 27.59], 'æ¹–åŒ—': [112.29, 31.00],
            'æ²³åŒ—': [115.50, 38.04], 'è´µå·': [106.71, 26.57], 'å¹¿è¥¿': [108.32, 23.52],
            'é»‘é¾™æ±Ÿ': [128.00, 47.50], 'å‰æ—': [126.20, 43.80], 'æµ·å—': [109.70, 19.10],
            'å¤©æ´¥': [117.20, 39.08], 'é‡åº†': [107.50, 29.80], 'æ±Ÿè¥¿': [115.50, 27.80],
            'è¾½å®': [122.50, 41.30], 'ç¦å»º': [118.00, 26.00], 'é’æµ·': [96.00, 35.50],
            'è¥¿è—': [89.00, 31.50]
        };

        // è‡ªå®šä¹‰æ ‡ç­¾åæ ‡
        const labelFixCoords = {
            'å¤©æ´¥': [118.50, 38.60], 
            'æ²³åŒ—': [115.20, 38.10], 
            'åŒ—äº¬': [116.10, 40.80], 
            'ä¸Šæµ·': [122.80, 31.23], 
            'é‡åº†': [107.50, 30.20],
            'é¦™æ¸¯': [114.10, 22.00],
            'æ¾³é—¨': [113.50, 22.00]
        };

        const flowLinesData = [
            {fromName: 'æ–°ç–†', toName: 'æ²³å—', coords: [geoCoordMap['æ–°ç–†'], geoCoordMap['æ²³å—']]},
            {fromName: 'æ–°ç–†', toName: 'å®‰å¾½', coords: [geoCoordMap['æ–°ç–†'], geoCoordMap['å®‰å¾½']]},
            {fromName: 'å®å¤', toName: 'æµ™æ±Ÿ', coords: [geoCoordMap['å®å¤'], geoCoordMap['æµ™æ±Ÿ']]},
            {fromName: 'ç”˜è‚ƒ', toName: 'æ¹–å—', coords: [geoCoordMap['ç”˜è‚ƒ'], geoCoordMap['æ¹–å—']]},
            {fromName: 'é™•è¥¿', toName: 'æ¹–åŒ—', coords: [geoCoordMap['é™•è¥¿'], geoCoordMap['æ¹–åŒ—']]},
            {fromName: 'å†…è’™å¤', toName: 'å±±ä¸œ', coords: [geoCoordMap['å†…è’™å¤'], geoCoordMap['å±±ä¸œ']]},
            {fromName: 'å†…è’™å¤', toName: 'åŒ—äº¬', coords: [geoCoordMap['å†…è’™å¤'], geoCoordMap['åŒ—äº¬']]},
            {fromName: 'å±±è¥¿', toName: 'æ±Ÿè‹', coords: [geoCoordMap['å±±è¥¿'], geoCoordMap['æ±Ÿè‹']]},
            {fromName: 'å››å·', toName: 'æ±Ÿè‹', coords: [geoCoordMap['å››å·'], geoCoordMap['æ±Ÿè‹']]},
            {fromName: 'å››å·', toName: 'ä¸Šæµ·', coords: [geoCoordMap['å››å·'], geoCoordMap['ä¸Šæµ·']]},
            {fromName: 'å››å·', toName: 'æµ™æ±Ÿ', coords: [geoCoordMap['å››å·'], geoCoordMap['æµ™æ±Ÿ']]},
            {fromName: 'æ¹–åŒ—', toName: 'ä¸Šæµ·', coords: [geoCoordMap['æ¹–åŒ—'], geoCoordMap['ä¸Šæµ·']]},
            {fromName: 'äº‘å—', toName: 'å¹¿ä¸œ', coords: [geoCoordMap['äº‘å—'], geoCoordMap['å¹¿ä¸œ']]},
            {fromName: 'è´µå·', toName: 'å¹¿ä¸œ', coords: [geoCoordMap['è´µå·'], geoCoordMap['å¹¿ä¸œ']]}
        ];

        const nameMap = {
            'å†…è’™å¤': 'å†…è’™å¤è‡ªæ²»åŒº', 'æ–°ç–†': 'æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº', 'å¹¿è¥¿': 'å¹¿è¥¿å£®æ—è‡ªæ²»åŒº',
            'å®å¤': 'å®å¤å›æ—è‡ªæ²»åŒº', 'è¥¿è—': 'è¥¿è—è‡ªæ²»åŒº', 'é¦™æ¸¯': 'é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº', 'æ¾³é—¨': 'æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº'
        };

        const mapData = rawData.map(item => ({
            name: nameMap[item.name] || (item.name.match(/åŒ—äº¬|å¤©æ´¥|ä¸Šæµ·|é‡åº†/) ? item.name + 'å¸‚' : item.name + 'çœ'),
            value: item.value,
            originalName: item.name
        }));

        // æ ‡ç­¾æ•°æ®å¤„ç†
        const labelData = mapData.map(item => {
            const fixCoord = labelFixCoords[item.originalName];
            const defaultCoord = geoCoordMap[item.originalName];
            if (!fixCoord && !defaultCoord) return null;
            return {
                name: item.name,
                value: fixCoord ? [...fixCoord, item.value] : [...defaultCoord, item.value],
                originalName: item.originalName,
                displayValue: item.value
            };
        }).filter(item => item !== null);

        // --- æ¸²æŸ“å³ä¾§æ¡å½¢å›¾ ---
        function renderBars() {
            const exportData = [...rawData].sort((a, b) => a.value - b.value).slice(0, 5);
            const importData = [...rawData].sort((a, b) => b.value - a.value).slice(0, 5);
            const maxVal = Math.max(Math.abs(exportData[0].value), Math.abs(importData[0].value));

            const createBar = (item, type) => {
                const percent = (Math.abs(item.value) / maxVal) * 100;
                const colorClass = type === 'out' ? 'color-out' : 'color-in';
                const textClass = type === 'out' ? 'text-out' : 'text-in';
                const sign = type === 'in' ? '+' : '';
                return `
                    <div class="chart-row">
                        <div class="row-label">${item.name}</div>
                        <div class="bar-container">
                            <div class="bar-fill ${colorClass}" style="width: ${percent}%"></div>
                        </div>
                        <div class="row-value ${textClass}">${sign}${Math.abs(item.value)}</div>
                    </div>
                `;
            };

            document.getElementById('export-bars').innerHTML = exportData.map(d => createBar(d, 'out')).join('');
            document.getElementById('import-bars').innerHTML = importData.map(d => createBar(d, 'in')).join('');
        }
        renderBars();

        // --- åœ°å›¾åˆå§‹åŒ– ---
        const myChart = echarts.init(document.getElementById('echarts-map'));
        myChart.showLoading();

        fetch('https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json')
            .then(response => response.json())
            .then(geoJson => {
                myChart.hideLoading();
                echarts.registerMap('china', geoJson);

                const option = {
                    backgroundColor: 'transparent',
                    geo: {
                        map: 'china',
                        roam: true,
                        zoom: 1.1,
                        center: [104, 36],
                        label: { show: false },
                        itemStyle: {
                            borderColor: '#fff',
                            borderWidth: 1.5,
                            areaColor: '#f5f5f5',
                            shadowColor: 'rgba(0, 0, 0, 0.1)',
                            shadowBlur: 10
                        },
                        emphasis: {
                            itemStyle: { areaColor: '#eceff1' },
                            label: { show: false }
                        }
                    },
                    visualMap: {
                        show: false,
                        type: 'piecewise',
                        pieces: [
                            {min: 1000, color: '#c0392b'},    
                            {min: 50, max: 999, color: '#ffab91'}, 
                            {min: -49, max: 49, color: '#ffffff'}, 
                            {min: -999, max: -50, color: '#b2dfdb'}, 
                            {max: -1000, color: '#00897b'}   
                        ]
                    },
                    series: [
                        {
                            type: 'map',
                            geoIndex: 0,
                            data: mapData
                        },
                        // æ ‡ç­¾å±‚ (Scatter)
                        {
                            type: 'scatter',
                            coordinateSystem: 'geo',
                            data: labelData,
                            symbolSize: 1,
                            label: {
                                show: true,
                                formatter: function(params) {
                                    const val = params.data.displayValue;
                                    const name = params.data.originalName;
                                    if (val === 0) return `{b|${name}}`;
                                    const sign = val > 0 ? '+' : '';
                                    return `{b|${name}}\n{a|${sign}${val}}`;
                                },
                                textShadowColor: '#fff',
                                textShadowBlur: 3,
                                textShadowOffsetX: 0,
                                textShadowOffsetY: 0,
                                color: '#333', 
                                rich: {
                                    a: { fontSize: 11, fontWeight: 'bold', lineHeight: 14, color: '#222', textShadowColor: '#fff', textShadowBlur: 3 },
                                    b: { fontSize: 11, color: '#444', textShadowColor: '#fff', textShadowBlur: 3 }
                                }
                            },
                            zlevel: 3
                        },
                        // è¾“ç”µçº¿è·¯ (Lines) - å¼ºåŒ–æ˜¾ç¤º
                        {
                            type: 'lines',
                            coordinateSystem: 'geo',
                            zlevel: 5,
                            symbol: ['none', 'arrow'],
                            symbolSize: 14,
                            symbolKeepAspect: true,
                            effect: {
                                show: true,
                                symbol: 'arrow',
                                symbolSize: 10,
                                trailLength: 0,
                                constantSpeed: 30,
                                color: '#2c3e50'
                            },
                            lineStyle: {
                                color: '#2c3e50',
                                width: 3,
                                opacity: 0.95,
                                curveness: 0.2
                            },
                            data: flowLinesData
                        }
                    ]
                };

                myChart.setOption(option);
            })
            .catch(error => {
                console.error("åŠ è½½å¤±è´¥:", error);
            });

        window.addEventListener('resize', () => {
            myChart.resize();
        });
    </script>
</body>
</html>
